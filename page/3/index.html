<!doctype html><html><head><meta name=generator content="Hugo 0.70.0"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>cxfksword's notes</title><meta name=description content="simple thinking, simple life."><meta property="og:title" content="cxfksword's notes"><meta property="og:type" content="website"><meta property="og:description" content="simple thinking, simple life."><meta property="og:url" content="//blog.tri-lib.com/"><meta property="og:site_name" content="cxfksword's notes"><meta property="og:image" content="//blog.tri-lib.com/images/thumbnail.png"><link rel=icon href=//blog.tri-lib.com/favicon.ico type=image/x-icon><link rel=canonical href=//blog.tri-lib.com/><link rel=alternate type=application/rss+xml href=//blog.tri-lib.com/index.xml title="cxfksword's notes"><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/agate.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Noto+Sans+KR&display=swap"><link rel=stylesheet href=//blog.tri-lib.com/css/styles.css><link rel=stylesheet href=//blog.tri-lib.com/static/css/style.css><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-154973579-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-154973579-1');</script><script type=text/javascript>function toggle_visibility(id){var e=document.getElementById(id);if(e.className==='menu')
e.className='menu hidden';else
e.className='menu';}</script></head><body><div class=navbar><div class=logo><a href=//blog.tri-lib.com/><img src=//blog.tri-lib.com/images/logo.png height=34px></a></div><div class=burger><button onclick="toggle_visibility('menu')">
<i class="fa fa-bars" aria-hidden=true></i>Menu</button></div><div id=menu class="menu hidden"><ul><li><a href=//blog.tri-lib.com/>#Home</a></li><li><a href=//blog.tri-lib.com/categories>#Categories</a></li><li><a href=//blog.tri-lib.com/tags>#Tags</a></li><li><a href=//blog.tri-lib.com/projects>#Projects</a></li><li><a href=//blog.tri-lib.com/star>#Star</a></li><li><a href=//blog.tri-lib.com/abouts>#Abouts</a></li></ul><input class=search id=search-input type=search placeholder=Keyword></div></div><div class=container><div class=post><div class=post-title><a href=//blog.tri-lib.com/2012/03/find-who-connect-to-database/ title=如何查看哪些进程和服务器正在使用数据库><img src=//blog.tri-lib.com/images/post-title-icon.png><div class=post-meta><time>Saturday, 2012年3月17号 09:33</time><h1>如何查看哪些进程和服务器正在使用数据库</h1></div></a></div><div><p>工作中有时会碰到需要迁移数据库的时候，如更换机房，更换新服务器等。迁移数据库最重要是要确保正在运行的程序不会因为漏更改连接字符串而导致程序报错。但有时维护的项目可能老旧，没有相关维护文档，还有一些使用该数据库的windows服务也可能遍布在其他服务器上，这时我们该如何找到所有正在使用该数据库的服务呢？</p><p>下面以windows服务器和Sql Server数据库为例，数据库服务器的ip是192.168.6.189，linux平台的思路差不多，只是命令有变化。</p><h3 id=1查看sql-server进程id>1、查看Sql Server进程ID</h3><p>打开任务管理器，点击“<strong>查看</strong>-><strong>选择列</strong>”，勾选“<strong>PID(进程标识符)</strong>”
<img src=http://ww1.sinaimg.cn/large/7ce4a9f6gw1e5q1p9zo5yj20b70bkabs.jpg alt="sql server">
<img src=http://ww4.sinaimg.cn/large/7ce4a9f6gw1e5q1pyu9epj205k07ywf2.jpg alt="sql server"></p><p>进程名称为“<strong>sqlservr.exe</strong>”的PID就是Sql Server的进程ID，当前是<strong>1800</strong>。</p><a href=//blog.tri-lib.com/2012/03/find-who-connect-to-database/ class=summary-more>More</a></div></div><hr class=summary-sep><div class=post><div class=post-title><a href=//blog.tri-lib.com/2012/03/understanding-iis-host-headers/ title="了解IIS的主机名(Host Headers)配置项"><img src=//blog.tri-lib.com/images/post-title-icon.png><div class=post-meta><time>Saturday, 2012年3月3号 17:00</time><h1>了解IIS的主机名(Host Headers)配置项</h1></div></a></div><div><p>IIS可以在一台服务器上配置多个web站点，每个站点通过ip地址、端口(port)和主机名(host)结合的标识符(ServerBindings Metabase)进行区分。标识字符串的格式如下：</p><pre><code>IP:Port:Hostname
</code></pre><p>上面的IP和Hostname是可选项，假如设定站点时不指定，表示匹配所有。</p><h3 id=主机名host-headers是http消息的一部分>主机名(Host Headers)是HTTP消息的一部分</h3><p>浏览器和web服务器之间是通过http协议通信的。http发送的请求头部(headers)部分包含有很多信息，如Content-Length, Referer, <strong>Host</strong>等等。</p><a href=//blog.tri-lib.com/2012/03/understanding-iis-host-headers/ class=summary-more>More</a></div></div><hr class=summary-sep><div class=post><div class=post-title><a href=//blog.tri-lib.com/2012/02/how-to-install-vmware-tools-in-ubuntu-server/ title="如何在ubuntu server 10.04中安装vmware tools"><img src=//blog.tri-lib.com/images/post-title-icon.png><div class=post-meta><time>Sunday, 2012年2月19号 08:07</time><h1>如何在ubuntu server 10.04中安装vmware tools</h1></div></a></div><div><p>本人的ubuntu server版本是10.04.4，安装在免费的vmware player 4.0中。
安装vmware-tools需要gcc和对应的linux-headers进行编译，需先执行下面两个命令进行安装：</p><pre><code>sudo apt-get gcc

sudo apt-get install build-essential linux-headers-$(uname -r)
</code></pre><p>安装后，点击vmware player菜单“Virtual Machine->Install VMware Tools”，画面下方会出现黄色的VMware Tools安装提示框。
1、把安装光盘绑定到一个文件夹：</p><pre><code>mkdir /mnt/cdrom

sudo mount /dev/cdrom /mnt/cdrom
</code></pre><a href=//blog.tri-lib.com/2012/02/how-to-install-vmware-tools-in-ubuntu-server/ class=summary-more>More</a></div></div><hr class=summary-sep><div class=post><div class=post-title><a href=//blog.tri-lib.com/2012/02/molas-isolation-framework/ title=Molas——.NET依赖分离框架><img src=//blog.tri-lib.com/images/post-title-icon.png><div class=post-meta><time>Tuesday, 2012年2月14号 17:29</time><h1>Molas——.NET依赖分离框架</h1></div></a></div><div><p><img src=http://research.microsoft.com/en-us/projects/pex/pexweb.png alt><a href=http://research.microsoft.com/en-us/projects/moles/>Moles</a>是由微软研究院(<a href=http://research.microsoft.com>Microsoft Research</a>)开发的.NET依赖分离框架，它实现了使用自定义的委托(delegate)方法来替换原有类中的方法，以达到分离依赖，方便单元测试的目的。Moles在功能和用法上与开源的IoC框架Moq很像，但Moles有一些Moq实现不了功能，如替换静态方法，去掉静态构造函数，突破访问限制等。Molas非常有利于对ASP.NET WebForm构建的网站和依赖第三方类库的程序进行单元测试。</p><h2 id=下载和安装>下载和安装</h2><p><a href=http://research.microsoft.com/en-us/projects/pex/downloads.aspx>下载Moles</a>后直接安装就可以了，里面集成有VS2010的插件，安装成功后，VS2010右键菜单中会集成Moles功能菜单。</p><a href=//blog.tri-lib.com/2012/02/molas-isolation-framework/ class=summary-more>More</a></div></div><hr class=summary-sep><div class=post><div class=post-title><a href=//blog.tri-lib.com/2012/02/windbg-useful-commands/ title=WinDbg常用命令><img src=//blog.tri-lib.com/images/post-title-icon.png><div class=post-meta><time>Thursday, 2012年2月2号 03:33</time><h1>WinDbg常用命令</h1></div></a></div><div><p><a href=2012/02/intro-to-windbg-for-dotnet-developers/>前一篇文章</a>介绍了WinDbg入门，本篇主要介绍WinDbg常用命令和用法。</p><p>调试程序的CPU满载问题，关键是要知道程序当前正在进行什么操作。假如我们在cpu满载时创建了一个dump文件，使用下面几个命令可以查看当前程序正在进行什么处理：
<strong>.time</strong>
运行.time命令会显示时间相关的信息，如系统运行时间，进程运行时间和CPU花费在内核态和用户态的时间。</p><pre><code>0:000&gt; .time
Debug session time: Tue Oct 23 08:38:35.000 2007 (GMT+1)
System Uptime: 4 days 17:48:01.906
Process Uptime: 0 days 0:24:37.000
  Kernel time: 0 days 0:04:23.000
  User time: 0 days 0:03:28.000
</code></pre><p>你可以看到系统已正常运行超过4天，进程运行了24分钟，CPU在内核态和用户态累积使用了8分钟。根据进程时间和CPU时间能大概估算出CPU使用率平均值是32.5%。</p><a href=//blog.tri-lib.com/2012/02/windbg-useful-commands/ class=summary-more>More</a></div></div><hr class=summary-sep><div class=post><div class=post-title><a href=//blog.tri-lib.com/2012/02/intro-to-windbg-for-dotnet-developers/ title=面向.NET开发人员的WinDbg入门教程><img src=//blog.tri-lib.com/images/post-title-icon.png><div class=post-meta><time>Wednesday, 2012年2月1号 08:28</time><h1>面向.NET开发人员的WinDbg入门教程</h1></div></a></div><div><p>原文：<a href=http://blogs.msdn.com/b/kaevans/archive/2011/04/11/intro-to-windbg-for-net-developers.aspx>http://blogs.msdn.com/b/kaevans/archive/2011/04/11/intro-to-windbg-for-net-developers.aspx
</a> 翻译：cxfksword</p><p>当你的代码发布为产品后，无论是在其他人的电脑中运行，还是部署到服务器中，你通常不再能访问到它的程序文件，也不能观察到代码的当前运行情况和运行环境。当你的代码在新的环境运行时，有很多因素会影响到程序的运行情况，如服务器系统打了更新补丁，网络策略改变，防火墙规则限制，磁盘权限配置等等。当代码运行不正常时，你可能只能靠代码中各处输出的日志来判断运行情况。但只靠输出日志，你有时还是不能判断故障出现的原因。</p><p>在不浪费客户时间的同时做故障排除对你是个很大的挑战，因为不会有客户喜欢被一个搞技术的家伙不断问是点了那个按钮操作了哪些步骤导致程序出错的。boss也不会给你几天甚至几周的时间让你慢慢排除故障，你必须现在就知道到底发生了什么。</p><p>理想情况下，你应该能看到堆栈跟踪，能查看到当前的变量值，能调试代码。事实证明你可以做到这点。。。而且不需要附加到客户环境中！</p><a href=//blog.tri-lib.com/2012/02/intro-to-windbg-for-dotnet-developers/ class=summary-more>More</a></div></div><hr class=summary-sep><div class=post><div class=post-title><a href=//blog.tri-lib.com/2012/01/zero-downtime-with-haproxy/ title=利用HAProxy实现零停机更新维护><img src=//blog.tri-lib.com/images/post-title-icon.png><div class=post-meta><time>Saturday, 2012年1月21号 08:04</time><h1>利用HAProxy实现零停机更新维护</h1></div></a></div><div><p><a href=http://haproxy.1wt.eu/>HAProxy</a>是linux平台上的负载均衡软件，有完善的服务器健康检测和会话(session)保持功能，性能高，支持tcp和http网络连接分发。</p><h2 id=问题起因><strong>问题起因</strong></h2><p>入公司一年，我发现在ASP.NET网站上部署更新时，经常会遇到下面这样的烦恼：</p><ol><li><p>假如更新到bin文件夹下的dll文件，会引起iis的应用程序池重启，从而导致更新这段时间内，用户访问网站会非常缓慢，甚至出现页面超时。</p></li><li><p>部署更新时要小心翼翼，祈祷上帝没少拷了什么文件，假如更新后网站出错，就只能心跳加速地快速还原系统</p></li><li><p>编辑经常提一些需求只是简单更改下页面文字，而为了不使这种简单的更改引起应用程序池重启，一般部署网站时都是采用copy方式发布，而网站也工作在debug模式下，而不是更优化速度更快的release模式</p></li></ol><a href=//blog.tri-lib.com/2012/01/zero-downtime-with-haproxy/ class=summary-more>More</a></div></div><hr class=summary-sep><div class=post><div class=post-title><a href=//blog.tri-lib.com/2012/01/use-eclipse-scala-develop-android/ title=利用Eclipse+Scala搭建android开发环境><img src=//blog.tri-lib.com/images/post-title-icon.png><div class=post-meta><time>Saturday, 2012年1月21号 07:06</time><h1>利用Eclipse+Scala搭建android开发环境</h1></div></a></div><div><p><strong>1、安装JAVA SDK</strong></p><p>到官网（<a href=http://www.oracle.com/technetwork/java/javase/downloads/index.html>http://www.oracle.com/technetwork/java/javase/downloads/index.html</a> ）下载最新的javase sdk，推荐安装1.6版。安装完成后，在windows环境变量中添加[JAVA_HOME]，并把路径指向java sdk的安装根目录。</p><p><img src=http://images.cnblogs.com/cnblogs_com/vento/scala-android-1.jpg alt></p><p><strong>2、安装Scala</strong></p><p>从scala官网（<a href=http://www.scala-lang.org/downloads>http://www.scala-lang.org/downloads</a> ）下载windows版的压缩包，推荐2.8.1 final版，直接解压到相应目录中，假设为c:\scala-2.8.1.final\，再添加下面两个环境变量：</p><ul><li><p>新增环境变量SCALA_HOME，并设为c:\scala-2.8.1.final</p></li><li><p>在已有环境变量Path中，追加值c:\scala-2.8.1.final\bin</p></li></ul><a href=//blog.tri-lib.com/2012/01/use-eclipse-scala-develop-android/ class=summary-more>More</a></div></div><hr class=summary-sep><div class=post><div class=post-title><a href=//blog.tri-lib.com/2012/01/config-windows-services-install-name/ title=使windows服务安装名称可配置><img src=//blog.tri-lib.com/images/post-title-icon.png><div class=post-meta><time>Thursday, 2012年1月12号 07:42</time><h1>使windows服务安装名称可配置</h1></div></a></div><div><p>有时，我们安装的windows服务可能是个框架，在同一服务器上可能服务于不同的系统，为了使服务名称不冲突，需要把服务名称更改为可配置。
因为ServiceInstaller能直接设置安装服务的名称和描述，所以很容易就能写出下面的代码：</p><pre><code>serviceInstaller.ServiceName = ConfigurationManager.AppSetting[&quot;ServiceName&quot;];
serviceInstaller.Description = ConfigurationManager.AppSetting[&quot;ServiceDescription&quot;];
</code></pre><p>编译执行安装，可惜抛出了异常，安装失败了。
<a href=http://cxfksword.me/wp-content/uploads/2012/01/QQ%E4%BA%94%E7%AC%94%E6%88%AA%E5%9B%BE%E6%9C%AA%E5%91%BD%E5%90%8D.png><img src=http://cxfksword.me/wp-content/uploads/2012/01/QQ%E4%BA%94%E7%AC%94%E6%88%AA%E5%9B%BE%E6%9C%AA%E5%91%BD%E5%90%8D.png alt></a>
失败的原因是，执行安装服务的程序是InstallUtil.exe，安装阶段不会自动加载服务的app.config配置文件，只会加载全局的machine.config，需改为手动加载app.config并读取。
确定解决思路后，我写出了下面的代码：</p><a href=//blog.tri-lib.com/2012/01/config-windows-services-install-name/ class=summary-more>More</a></div></div><hr class=summary-sep><div class=post><div class=post-title><a href=//blog.tri-lib.com/2012/01/get-client-ip/ title=获取客户端的真实ip代码改进><img src=//blog.tri-lib.com/images/post-title-icon.png><div class=post-meta><time>Monday, 2012年1月9号 07:39</time><h1>获取客户端的真实ip代码改进</h1></div></a></div><div><p>现在系统中常用的获取客户端真实ip的代码如下：</p><pre><code>// 获取IP地址
protected string GetIPAddress()
{
    string result = &quot;&quot;;
    try
    {
        //透过代理取客户端ip
        result = HttpContext.Current.Request.ServerVariables[&quot;HTTP_X_FORWARDED_FOR&quot;] ?? &quot;&quot;;
        if (result == &quot;&quot;)
        {
            //连接主机ip
            result = HttpContext.Current.Request.ServerVariables[&quot;REMOTE_ADDR&quot;] ?? &quot;&quot;;
        }
        if (result == &quot;&quot;)
        {
            result = HttpContext.Current.Request.UserHostAddress;
        }
    }
    catch (Exception ex)
    {
    }
    return result;
}
</code></pre><p>这段代码有两个问题：
1、根据<a href=http://www.openinfo.co.uk/apache/index.html>这篇文章</a>说明，当请求经常多个代理时，HTTP_X_FORWARDED_FOR可能会附加上多个服务器ip，格式如下：</p><a href=//blog.tri-lib.com/2012/01/get-client-ip/ class=summary-more>More</a></div></div><hr class=summary-sep><div class=paging><a href=//blog.tri-lib.com/page/2/ rel=prev>Prev
<i class="fa fa-caret-left" aria-hidden=true></i></a><span class=page>Page 3 / 5</span>
<a href=//blog.tri-lib.com/page/4/ rel=next><i class="fa fa-caret-right" aria-hidden=true></i></a></div><div class=go-top><a href=# class=go-top-button><i class="fa fa-angle-double-up"></i><span>Top</span></a></div><footer class=footer>COPYRIGHT (C) <a href=https://blog.lulab.net>DONGGEUN,BANG (LUBANG).</a><br>ALL RIGHTS RESERVED.</footer></body></html>