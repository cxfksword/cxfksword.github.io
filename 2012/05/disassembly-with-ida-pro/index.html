<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="IDA Pro是一款强大的反汇编软件，特有的IDA视图和交叉引用，可以方便理解程序逻辑和快速定位代码片断，以方便修改。 示例程序 下面会通过修改示例程序的输出字符串，来讲解如何使用IDA Pro。
#include main() { int n; scanf (&amp;quot;%d&amp;quot;,&amp;amp;n); if (n &amp;gt; 0) printf(&amp;quot;a &amp;gt; 0&amp;quot;); //后面会用IDA Pro把'a'改成'n' else printf(&amp;quot;n &amp;lt; 0&amp;quot;); }  编译后的程序下载：demo"><base href=//blog.tri-lib.com/><title>利用IDA Pro反汇编程序</title><link rel=canonical href=//blog.tri-lib.com/2012/05/disassembly-with-ida-pro/><link rel=stylesheet href=//blog.tri-lib.com/scss/style.min.css><meta property="og:title" content="利用IDA Pro反汇编程序"><meta property="og:description" content="IDA Pro是一款强大的反汇编软件，特有的IDA视图和交叉引用，可以方便理解程序逻辑和快速定位代码片断，以方便修改。 示例程序 下面会通过修改示例程序的输出字符串，来讲解如何使用IDA Pro。
#include main() { int n; scanf (&amp;quot;%d&amp;quot;,&amp;amp;n); if (n &amp;gt; 0) printf(&amp;quot;a &amp;gt; 0&amp;quot;); //后面会用IDA Pro把'a'改成'n' else printf(&amp;quot;n &amp;lt; 0&amp;quot;); }  编译后的程序下载：demo"><meta property="og:url" content="//blog.tri-lib.com/2012/05/disassembly-with-ida-pro/"><meta property="og:site_name" content="cxfksword's notes"><meta property="og:type" content="article"><meta name=twitter:title content="利用IDA Pro反汇编程序"><meta name=twitter:description content="IDA Pro是一款强大的反汇编软件，特有的IDA视图和交叉引用，可以方便理解程序逻辑和快速定位代码片断，以方便修改。 示例程序 下面会通过修改示例程序的输出字符串，来讲解如何使用IDA Pro。
#include main() { int n; scanf (&amp;quot;%d&amp;quot;,&amp;amp;n); if (n &amp;gt; 0) printf(&amp;quot;a &amp;gt; 0&amp;quot;); //后面会用IDA Pro把'a'改成'n' else printf(&amp;quot;n &amp;lt; 0&amp;quot;); }  编译后的程序下载：demo"><meta property="article:section" content="Post"><meta property="article:tag" content="IDA Pro"><meta property="article:tag" content="反汇编"><meta property="article:published_time" content="2012-05-16T16:30:16+00:00"><meta property="article:modified_time" content="2012-05-16T16:30:16+00:00"></head><body><div id=content><div class="container extended flex on-phone--column align-items--flex-start article-page with-toolbar"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><img src=//blog.tri-lib.com/img/avatar_hub76bbbc8c06c72418eefeedfe902e916_30687_300x300_resize_q75_box.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
<span class=emoji>🍥</span></figure><h1 class=site-name><a href=//blog.tri-lib.com/>cxfksword's notes</a></h1><h2 class=site-description>simple thinking, simple life.</h2></header><nav class=menu id=main-menu><li><a href=//blog.tri-lib.com/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>首页</span></a></li><li><a href=//blog.tri-lib.com/archive/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>归档</span></a></li><li><a href=//blog.tri-lib.com/projects><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg><span>项目</span></a></li><li><a href=//blog.tri-lib.com/abouts><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>关于</span></a></li><li><a href=//blog.tri-lib.com/index.xml><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg><span>订阅</span></a></li></nav></aside><div class="flex column do-not-overflow full-width"><main class=main><div id=article-toolbar><a href=//blog.tri-lib.com/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>Back</span></a></div><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=//blog.tri-lib.com/categories/%E6%8A%80%E6%9C%AF>技术</a></header><h2 class=article-title><a href=//blog.tri-lib.com/2012/05/disassembly-with-ida-pro/>利用IDA Pro反汇编程序</a></h2><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>May 16, 2012</time></footer></div></header><section class=article-content><p><a class=link href=http://www.hex-rays.com/products/ida/index.shtml target=_blank rel=noopener>IDA Pro</a>是一款强大的反汇编软件，特有的IDA视图和交叉引用，可以方便理解程序逻辑和快速定位代码片断，以方便修改。
<img src=http://ww3.sinaimg.cn/large/7ce4a9f6gw1e5q1vme0mij20ly0ihdil.jpg alt=IDA视图></p><h3 id=示例程序>示例程序</h3><p>下面会通过修改示例程序的输出字符串，来讲解如何使用IDA Pro。</p><pre><code>#include

main()
{
    int n;
    scanf (&quot;%d&quot;,&amp;n);
    if (n &gt; 0)
       printf(&quot;a &gt; 0&quot;);  //后面会用IDA Pro把'a'改成'n'
    else
       printf(&quot;n &lt; 0&quot;);
}
</code></pre><p>编译后的程序下载：<a class=link href=http://cxfksword.me/wp-content/uploads/2012/05/test.zip target=_blank rel=noopener>demo</a></p><h3 id=运行ida-pro>运行IDA Pro</h3><p>运行IDA Pro，并使用PE文件的方式打开示例的test.exe文件。IDA Pro会新建一个工程，并开始反汇编程序。反汇编完成后，在[IDA-View]窗口中，可以看到程序逻辑的树形图，如下：
<img src=http://ww1.sinaimg.cn/large/7ce4a9f6gw1e5q1xayieqj20jp0iztb6.jpg alt=树形图>
<img src=http://ww1.sinaimg.cn/large/7ce4a9f6gw1e5q1xrz40tj208v08574h.jpg alt=树形图>
树形图把条件分支清晰地显示出来了，<strong>绿色线</strong>连着的表示条件为true时执行的逻辑，而<strong>红色线</strong>表示条件为false时执行的逻辑。<strong>右下角</strong>有IDA视图的缩略图，在上面点击可以快速定位到视图的指定位置。</p><p>IDA的工具栏有几个按钮对定位代码很重要，如下图所示：
<img src=http://ww3.sinaimg.cn/large/7ce4a9f6gw1e5q1y4cfa7j203r00tt8i.jpg alt=定位相关功能按钮>
从左到右分别是：
<strong>Open exports window</strong>:打开导出窗口
<strong>Open import window</strong>:打开导入窗口
*<strong>Open names window</strong>:函数和参数的命名列表
*<strong>Open functions window</strong>:程序调用的所有函数窗口
*<strong>Open strings window</strong>: 打开字符串显示窗口，会列出程序中的所有字符串，该窗口有助于你通过程序的运行输出逆向找出对应的代码片断。</p><h3 id=定位代码片断>定位代码片断</h3><p>假设我们现在接到个任务，需修正程序，把输出“a > 0”修正为“n > 0”。示例程序比较简单，直接看IDA视图我们就能找到需修改的代码片断，但实际处理时，可能程序有几m大，通过一个个看IDA视图已没法有效找到相关的执行代码片断，这时怎么办？
使用字符串窗口和IDA强大的交叉引用！
点击工具栏的[Open strings windows]按钮，可以看到如下的程序字符串：
<img src=http://ww2.sinaimg.cn/large/7ce4a9f6gw1e5q1yut1etj20db03pmxq.jpg alt=程序字符串>
程序的字符串较少，可以很快地看到我们需要的字符串“a > 0”在数据段<strong>00403003</strong>位置。假如字符串多到已不能肉眼定位查找，因为字符串窗口是没有查找功能的，这时需要借助其他的文本编辑器，如notepad，editplus等。在字符串窗口内右键，选择菜单[copy]命令，会把字符串窗口的所有内容复制到剪贴板，再粘贴到记事本中查找就可以了。</p><p><strong>双击</strong>字符串窗口的该行字符串，会跳转到IDA视图的<strong>00403003位置，如下图所示：</strong></p><p><img src=http://ww4.sinaimg.cn/large/7ce4a9f6gw1e5q1zg56f5j20jx01vdg3.jpg alt=IDA视图></p><p>该位置的字符串后面会注释有DATA XREF的字样，这是程序中引用到该字符串的代码片断的地址！在该行上右键，选择[Jump to cross reference&mldr;]项，会立即跳转到引用该字符串的代码片断位置！</p><p><img src=http://ww2.sinaimg.cn/large/7ce4a9f6gw1e5q20cc1okj20eg04hgm8.jpg alt></p><p><img src=http://ww2.sinaimg.cn/large/7ce4a9f6gw1e5q20sej74j20b302yaa8.jpg alt></p><p>最后定位的代码片断
上图显示的汇编指令即是我们要找的代码片断，这时点击[Hex View-A]窗口，会切换到二进制浏览模式，并高亮了汇编代码的二进制格式指令，如下图所示：</p><p><img src=http://ww1.sinaimg.cn/large/7ce4a9f6gw1e5q215hg0cj20e60203z5.jpg alt></p><p>已找到需修改的代码片断，剩下的只需把a改成n。</p><h3 id=修改程序文件>修改程序文件</h3><p>在IDA中，可以在[Hex View-A]窗口右键选择[Edit]来修改二进制指令。修改后通过右键选择[Commit Change]可以看到修改后的IDA视图。但需要注意的是，这种方式的修改并不会更新原始程序文件，实际只是修改了IDA的项目文件！IDA中只适合做一些验证性的修改，确保正确后再使用其他工具修改原始程序文件。
在IDA中验证修改正确后，可以使用UltraEdit或Hex Workshop来修改原始程序文件。下面会以UltraEdit为例来说明如何修改。
<img src=http://ww3.sinaimg.cn/large/7ce4a9f6gw1e5q221zxgej20he084jtg.jpg alt></p><p>用UltraEdit直接打开程序文件，UltraEdit会以16进制模式显示程序文件。<strong>UltraEdit显示的地址和IDA显示的地址是不同的</strong>，为了找到对应代码片断在UltraEdit中的实际地址，需要使用到UltraEdit的查找功能。在IDA中复制需修改的16进制模式显示的指令，在UltraEdit中打开查找，粘贴并查找该16进制字符串，UltrEdit会很快定位到该指令处，如下图所示：</p><p><img src=http://ww2.sinaimg.cn/large/7ce4a9f6gw1e5q22llu5nj20et04z0u2.jpg alt>
在IDA中使得右键来复制
<img src=http://ww4.sinaimg.cn/large/7ce4a9f6gw1e5q233977pj20bp05gaao.jpg alt>
在UltraEdit打开查找功能
<img src=http://ww4.sinaimg.cn/large/7ce4a9f6gw1e5q23e9of1j20hc02vjsc.jpg alt>
找到了UltraEdit的对应位置</p><p>现在我们要把“a > 0”改成“n > 0”，a对应的ASCII码是61，而n对应的ASCII码是6E，只需把61改成6E就可以了，修改后保存。
<img src=http://ww3.sinaimg.cn/large/7ce4a9f6gw1e5q23tgcxbj20h800oaa3.jpg alt></p><p>再次运行，可以看到结果已改变！
<img src=http://ww1.sinaimg.cn/large/7ce4a9f6gw1e5q244d9g5j203y026dfn.jpg alt></p><p>示例只是修改了字符串，只需更改数据段内容就可以了，不用更改指令。假如需要更改指令，需要参考&lt; a href="http://courses.engr.illinois.edu/ece390/resources/opcodes.html#Main">8086指令操作表写出对应指今的16进制形式，再修改。</p><h3 id=参考资料>参考资料：</h3><p><a class=link href=http://blog.csdn.net/liquanhai/article/details/5479141 target=_blank rel=noopener>http://blog.csdn.net/liquanhai/article/details/5479141</a>
<a class=link href="http://www.youtube.com/watch?v=Gl2S0YPRb9s" target=_blank rel=noopener>http://www.youtube.com/watch?v=Gl2S0YPRb9s</a>
<a class=link href=http://www.woodmann.com/crackz/Tutorials/Flores1.htm target=_blank rel=noopener>http://www.woodmann.com/crackz/Tutorials/Flores1.htm</a>
<a class=link href=http://courses.engr.illinois.edu/ece390/resources/opcodes.html#Main target=_blank rel=noopener>http://courses.engr.illinois.edu/ece390/resources/opcodes.html#Main</a>
<a class=link href=http://faydoc.tripod.com/cpu/conventions.htm target=_blank rel=noopener>http://faydoc.tripod.com/cpu/conventions.htm</a></p></section><footer class=article-footer><section class=article-tags><a href=//blog.tri-lib.com/tags/ida-pro>I d a pro</a>
<a href=//blog.tri-lib.com/tags/%E5%8F%8D%E6%B1%87%E7%BC%96>反汇编</a></section></footer></article><aside class="widget related-contents--wrapper"></aside><footer class=site-footer><section class=copyright>&copy; 2020 cxfksword's notes</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank>Stack</a></b> designed by
<a href=https://jimmycai.com target=_blank>Jimmy</a></section></footer></main></div></div><div class=pswp tabindex=-1 role=dialog aria-hidden=true style=display:none><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=//blog.tri-lib.com/ts/main.js defer></script><script>(function(){const customFont=document.createElement('link');customFont.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";customFont.type="text/css";customFont.rel="stylesheet";document.head.appendChild(customFont);}());</script></body></html>